(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-05642d12"],{"07ac":function(e,t,i){var a=i("23e7"),n=i("6f53").values;a({target:"Object",stat:!0},{values:function(e){return n(e)}})},"25eb":function(e,t,i){var a=i("23e7"),n=i("c20d");a({target:"Number",stat:!0,forced:Number.parseInt!=n},{parseInt:n})},"43f2":function(e,t,i){},"5d60":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container",attrs:{id:"recordDetail"}},[i("div",{style:e.boxStyle},[i("div",[this.$route.query.mediaServerId?i("div",{staticClass:"page-header-btn",staticStyle:{"padding-right":"1rem"}},[i("b",[e._v("节点：")]),e._v(" "+e._s(e.mediaServerId)+" ")]):e._e(),this.$route.params.mediaServerId?i("div",[i("span",[e._v("流媒体："+e._s(this.$route.params.mediaServerId))])]):e._e(),i("div",{staticClass:"record-list-box-box"},[e.showSidebar?i("div",[i("el-date-picker",{staticStyle:{width:"190px"},attrs:{size:"mini","picker-options":e.pickerOptions,type:"date","value-format":"yyyy-MM-dd",placeholder:"日期"},on:{change:function(t){return e.dateChange()}},model:{value:e.chooseDate,callback:function(t){e.chooseDate=t},expression:"chooseDate"}})],1):e._e(),i("div",{staticClass:"record-list-box",staticStyle:{height:"calc(100vh - 170px)",overflow:"auto"}},[e.detailFiles.length>0?i("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.infiniteScroll,expression:"infiniteScroll"}],staticClass:"infinite-list record-list"},e._l(e.detailFiles,(function(t,a){return i("li",{key:a,staticClass:"infinite-list-item record-list-item"},[e.chooseFileIndex!==a?i("el-tag",{on:{click:function(t){return e.chooseFile(a)}}},[i("i",{staticClass:"el-icon-video-camera"}),e._v(" "+e._s(e.getFileShowName(t))+" ")]):e._e(),e.chooseFileIndex===a?i("el-tag",{attrs:{type:"danger"}},[i("i",{staticClass:"el-icon-video-camera"}),e._v(" "+e._s(e.getFileShowName(t))+" ")]):e._e(),i("a",{staticClass:"el-icon-download",staticStyle:{color:"#409EFF","font-weight":"600","margin-left":"10px"},attrs:{target:"_blank"},on:{click:function(i){return e.downloadFile(t)}}})],1)})),0):e._e(),0===e.detailFiles.length?i("div",{staticClass:"record-list-no-val"},[e._v("暂无数据")]):e._e()])])]),i("div",{attrs:{id:"playerBox"}},[i("div",{staticClass:"playBox",staticStyle:{height:"calc(100% - 90px)",width:"100%","background-color":"#000000"}},[e.playLoading?i("div",{staticStyle:{position:"relative",left:"calc(50% - 32px)",top:"43%","z-index":"100",color:"#fff",float:"left","text-align":"center"}},[i("div",{staticClass:"el-icon-loading"}),i("div",{staticStyle:{width:"100%","line-height":"2rem"}},[e._v("正在加载")])]):e._e(),i("h265web",{ref:"recordVideoPlayer",attrs:{"video-url":e.videoUrl,height:"calc(100vh - 250px)","show-button":!1},on:{playTimeChange:e.showPlayTimeChange,playStatusChange:e.playingChange}})],1),i("div",{staticClass:"player-option-box"},[i("VideoTimeline",{ref:"Timeline",attrs:{"init-time":e.initTime,"time-segments":e.timeSegments,"init-zoom-index":4},on:{timeChange:e.playTimeChange,mousedown:e.timelineMouseDown,mouseup:e.mouseupTimeline}}),e.showTime?i("div",{staticClass:"time-line-show"},[e._v(e._s(e.showTimeValue))]):e._e()],1),i("div",{staticStyle:{height:"40px","background-color":"#383838",display:"grid","grid-template-columns":"1fr 600px 1fr"}},[i("div",{staticStyle:{"text-align":"left"}},[i("div",{staticClass:"record-play-control",staticStyle:{"background-color":"transparent","box-shadow":"0 0 10px transparent"}},[i("a",{staticClass:"record-play-control-item iconfont icon-list",attrs:{target:"_blank",title:"列表"},on:{click:function(t){return e.sidebarControl()}}}),i("a",{staticClass:"record-play-control-item iconfont icon-camera1196054easyiconnet",attrs:{target:"_blank",title:"截图"},on:{click:function(t){return e.snap()}}})])]),i("div",{staticStyle:{"text-align":"center"}},[i("div",{staticClass:"record-play-control"},[e.chooseFileIndex>0?i("a",{staticClass:"record-play-control-item iconfont icon-diyigeshipin",attrs:{target:"_blank",title:"上一个"},on:{click:function(t){return e.playLast()}}}):i("a",{staticClass:"record-play-control-item iconfont icon-diyigeshipin",staticStyle:{color:"#acacac",cursor:"not-allowed"},attrs:{target:"_blank",title:"上一个"}}),i("a",{staticClass:"record-play-control-item iconfont icon-kuaijin",attrs:{target:"_blank",title:"快退五秒"},on:{click:function(t){return e.seekBackward()}}}),i("a",{staticClass:"record-play-control-item iconfont icon-stop1",staticStyle:{"font-size":"14px"},attrs:{target:"_blank",title:"停止"},on:{click:function(t){return e.stopPLay()}}}),e.playing?i("a",{staticClass:"record-play-control-item iconfont icon-zanting",attrs:{target:"_blank",title:"暂停"},on:{click:function(t){return e.pausePlay()}}}):e._e(),e.playing?e._e():i("a",{staticClass:"record-play-control-item iconfont icon-kaishi",attrs:{target:"_blank",title:"播放"},on:{click:function(t){return e.play()}}}),i("a",{staticClass:"record-play-control-item iconfont icon-houtui",attrs:{target:"_blank",title:"快进五秒"},on:{click:function(t){return e.seekForward()}}}),e.chooseFileIndex<e.detailFiles.length-1?i("a",{staticClass:"record-play-control-item iconfont icon-zuihouyigeshipin",attrs:{target:"_blank",title:"下一个"},on:{click:function(t){return e.playNext()}}}):i("a",{staticClass:"record-play-control-item iconfont icon-zuihouyigeshipin",staticStyle:{color:"#acacac",cursor:"not-allowed"},attrs:{target:"_blank",title:"下一个"},on:{click:function(t){return e.playNext()}}}),i("el-dropdown",{on:{command:e.changePlaySpeed}},[i("a",{staticClass:"record-play-control-item record-play-control-speed",attrs:{target:"_blank",title:"倍速播放"}},[e._v(e._s(e.playSpeed)+"X")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.playSpeedRange,(function(t){return i("el-dropdown-item",{key:t,attrs:{command:t}},[e._v(e._s(t)+"X")])})),1)],1)],1)]),i("div",{staticStyle:{"text-align":"right"}},[i("div",{staticClass:"record-play-control",staticStyle:{"background-color":"transparent","box-shadow":"0 0 10px transparent"}},[e.isFullScreen?i("a",{staticClass:"record-play-control-item iconfont icon-suoxiao1",attrs:{target:"_blank",title:"全屏"},on:{click:function(t){return e.fullScreen()}}}):i("a",{staticClass:"record-play-control-item iconfont icon-fangdazhanshi",attrs:{target:"_blank",title:"全屏"},on:{click:function(t){return e.fullScreen()}}})])])])])])])},n=[],r=(i("99af"),i("a630"),i("25eb"),i("d3b7"),i("07ac"),i("6062"),i("3ca3"),i("ddb0"),i("4f91")),o=i("76f0"),s=i("c1df"),l=i.n(s),c=i("93bf"),d=i.n(c),u={name:"CloudRecordDetail",components:{h265web:r["a"],VideoTimeline:o["a"]},data:function(){var e=this;return{showSidebar:!1,app:this.$route.params.app,stream:this.$route.params.stream,mediaServerId:null,dateFilesObj:[],mediaServerList:[],detailFiles:[],videoUrl:null,streamInfo:null,loading:!1,chooseDate:null,playTime:null,playerTime:null,playSpeed:1,chooseFileIndex:null,queryDate:new Date,currentPage:1,count:1e6,total:0,playLoading:!1,showTime:!0,isFullScreen:!1,playSeekValue:0,playing:!1,taskTimeRange:[],timeFormat:"00:00:00",initTime:null,timelineControl:!1,showOtherSpeed:!0,timeSegments:[],pickerOptions:{cellClassName:function(t){var i=l()(t).format("YYYY-MM-DD");return e.dateFilesObj[i]?"data-picker-true":"data-picker-false"}},playSpeedRange:[1,2,4,6,8,16,20]}},computed:{boxStyle:function(){return this.showSidebar?{display:"grid",gridTemplateColumns:"210px minmax(0, 1fr)"}:{display:"grid",gridTemplateColumns:"0 minmax(0, 1fr)"}},showTimeValue:function(){return l()(this.playTime).format("YYYY-MM-DD HH:mm:ss")}},mounted:function(){var e=this;this.getDateInYear((function(){Object.values(e.dateFilesObj).length>0&&(e.chooseDate=Object.values(e.dateFilesObj)[Object.values(e.dateFilesObj).length-1],e.dateChange())}))},destroyed:function(){this.$destroy("recordVideoPlayer")},methods:{sidebarControl:function(){this.showSidebar=!this.showSidebar},snap:function(){this.$refs.recordVideoPlayer.screenshot()},playLast:function(){0!==this.chooseFileIndex&&this.chooseFile(this.chooseFileIndex-1)},playNext:function(){this.chooseFileIndex!==this.detailFiles.length-1&&this.chooseFile(this.chooseFileIndex+1)},changePlaySpeed:function(e){console.log(e),this.playSpeed=e,this.$store.dispatch("cloudRecord/speed",{mediaServerId:this.streamInfo.mediaServerId,app:this.streamInfo.app,stream:this.streamInfo.stream,speed:this.playSpeed,schema:"ts"}),this.$refs.recordVideoPlayer.setPlaybackRate(this.playSpeed)},seekBackward:function(){this.playSeekValue-=5e3,this.playRecord()},seekForward:function(){this.playSeekValue+=5e3,this.playRecord()},stopPLay:function(){this.$refs.recordVideoPlayer.destroy()},pausePlay:function(){this.$refs.recordVideoPlayer.pause()},play:function(){this.$refs.recordVideoPlayer.loaded?this.$refs.recordVideoPlayer.unPause():this.playRecord()},fullScreen:function(){var e=this;if(this.isFullScreen)return d.a.exit(),void(this.isFullScreen=!1);var t=this.$refs.recordVideoPlayer.playerWidth,i=this.$refs.recordVideoPlayer.playerHeight;d.a.request(document.getElementById("playerBox")),d.a.on("change",(function(a){e.$refs.recordVideoPlayer.resize(t,i),e.isFullScreen=d.a.isFullscreen})),this.isFullScreen=!0},dateChange:function(){this.detailFiles=[],this.currentPage=1;var e=new Date(this.chooseDate+" "+this.timeFormat);e.getFullYear()===this.queryDate.getFullYear()&&e.getMonth()===this.queryDate.getMonth()||(this.queryDate=e,this.getDateInYear()),this.queryRecordDetails()},infiniteScroll:function(){this.total>this.detailFiles.length&&(this.currentPage++,this.queryRecordDetails())},queryRecordDetails:function(e){var t=this;this.timeSegments=[],this.$store.dispatch("cloudRecord/queryList",{app:this.app,stream:this.stream,startTime:this.chooseDate+" 00:00:00",endTime:this.chooseDate+" 23:59:59",page:this.currentPage,count:this.count,mediaServerId:this.mediaServerId,ascOrder:!0}).then((function(e){t.total=e.total,t.detailFiles=t.detailFiles.concat(e.list);var i=new Set;t.initTime=Number.parseInt(t.detailFiles[0].startTime);for(var a=0;a<t.detailFiles.length;a++)i.add(t.detailFiles[a].mediaServerId),t.timeSegments.push({beginTime:Number.parseInt(t.detailFiles[a].startTime),endTime:Number.parseInt(t.detailFiles[a].endTime),color:"#01901d",startRatio:.7,endRatio:.85,index:a});t.mediaServerList=Array.from(i),1===t.mediaServerList.length&&(t.mediaServerId=t.mediaServerList[0])})).catch((function(e){console.log(e)})).finally((function(){t.loading=!1,e&&e()}))},chooseFile:function(e){this.chooseFileIndex=e;for(var t=0,i=0;i<this.detailFiles.length;i++)i<e&&(t+=this.detailFiles[i].timeLen);this.playSeekValue=t,this.playRecord()},playRecord:function(){var e=this;this.$refs.recordVideoPlayer.playing||this.$refs.recordVideoPlayer.destroy(),this.$store.dispatch("cloudRecord/loadRecord",{app:this.app,stream:this.stream,date:this.chooseDate}).then((function(t){e.streamInfo=t,"https:"===location.protocol?e.videoUrl=t["https_fmp4"]+"&time="+(new Date).getTime():e.videoUrl=t["fmp4"]+"&time="+(new Date).getTime(),e.seekRecord()})).catch((function(e){console.log(e)})).finally((function(){e.playLoading=!1}))},seekRecord:function(){this.$store.dispatch("cloudRecord/seek",{mediaServerId:this.streamInfo.mediaServerId,app:this.streamInfo.app,stream:this.streamInfo.stream,seek:this.playSeekValue,schema:"fmp4"}).catch((function(e){console.log(e)}))},downloadFile:function(e){this.$store.dispatch("cloudRecord/getPlayPath",e.id).then((function(t){var i=document.createElement("a");i.target="_blank","https:"===location.protocol?i.href=t.httpsPath+"&save_name="+e.fileName:i.href=t.httpPath+"&save_name="+e.fileName,i.click()})).catch((function(e){console.log(e)}))},backToList:function(){this.$router.back()},getFileShowName:function(e){return l()(e.startTime).format("HH:mm:ss")+"-"+l()(e.endTime).format("HH:mm:ss")},showPlayTimeChange:function(e){this.playTime+=1e3*e-this.playerTime,this.playerTime=1e3*e},playingChange:function(e){this.playing=e},playTimeChange:function(e){e!==this.playTime&&(this.playTime=e)},timelineMouseDown:function(){this.timelineControl=!0},mouseupTimeline:function(e){if(this.timelineControl){this.timelineControl=!1;for(var t=0,i=0;i<this.detailFiles.length;i++){var a=this.detailFiles[i];if(this.playTime>a.endTime)t+=a.timeLen;else{if(this.playTime===a.endTime){t+=a.timeLen,this.chooseFileIndex=i;break}if(this.playTime>a.startTime&&this.playTime<a.endTime){t+=this.playTime-a.startTime,this.chooseFileIndex=i;break}}}this.playSeekValue=t,this.playRecord()}else this.timelineControl=!1},getTimeForFile:function(e){var t=new Date(1e3*e.startTime),i=new Date(1e3*e.endTime);return this.checkIsOver24h(t,i)&&(i=new Date(this.chooseDate+" 23:59:59")),[t,i,i.getTime()-t.getTime()]},checkIsOver24h:function(e,t){return e>t},playTimeFormat:function(e){var t=parseInt(e/3600),i=parseInt((e-3600*t)/60),a=parseInt(e-3600*t-60*i),n=t,r=i,o=a;return t<10&&(n="0"+n),i<10&&(r="0"+r),a<10&&(o="0"+o),n+":"+r+":"+o},getDateInYear:function(e){var t=this;this.dateFilesObj={},this.$store.dispatch("cloudRecord/queryListByData",{app:this.app,stream:this.stream,year:this.queryDate.getFullYear(),month:this.queryDate.getMonth()+1,mediaServerId:this.mediaServerId}).then((function(i){if(i.length>0){for(var a=0;a<i.length;a++)t.dateFilesObj[i[a]]=i[a];console.log(t.dateFilesObj)}e&&e()})).catch((function(e){console.log(e)}))},goBack:function(){this.$router.push("/cloudRecord")}}},h=u,f=(i("e01ac"),i("2877")),p=Object(f["a"])(h,a,n,!1,null,null,null);t["default"]=p.exports},6062:function(e,t,i){"use strict";var a=i("6d61"),n=i("6566");e.exports=a("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n)},6566:function(e,t,i){"use strict";var a=i("9bf2").f,n=i("7c73"),r=i("e2cc"),o=i("0366"),s=i("19aa"),l=i("2266"),c=i("7dd0"),d=i("2626"),u=i("83ab"),h=i("f183").fastKey,f=i("69f3"),p=f.set,m=f.getterFor;e.exports={getConstructor:function(e,t,i,c){var d=e((function(e,a){s(e,d,t),p(e,{type:t,index:n(null),first:void 0,last:void 0,size:0}),u||(e.size=0),void 0!=a&&l(a,e[c],e,i)})),f=m(t),y=function(e,t,i){var a,n,r=f(e),o=v(e,t);return o?o.value=i:(r.last=o={index:n=h(t,!0),key:t,value:i,previous:a=r.last,next:void 0,removed:!1},r.first||(r.first=o),a&&(a.next=o),u?r.size++:e.size++,"F"!==n&&(r.index[n]=o)),e},v=function(e,t){var i,a=f(e),n=h(t);if("F"!==n)return a.index[n];for(i=a.first;i;i=i.next)if(i.key==t)return i};return r(d.prototype,{clear:function(){var e=this,t=f(e),i=t.index,a=t.first;while(a)a.removed=!0,a.previous&&(a.previous=a.previous.next=void 0),delete i[a.index],a=a.next;t.first=t.last=void 0,u?t.size=0:e.size=0},delete:function(e){var t=this,i=f(t),a=v(t,e);if(a){var n=a.next,r=a.previous;delete i.index[a.index],a.removed=!0,r&&(r.next=n),n&&(n.previous=r),i.first==a&&(i.first=n),i.last==a&&(i.last=r),u?i.size--:t.size--}return!!a},forEach:function(e){var t,i=f(this),a=o(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:i.first){a(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!v(this,e)}}),r(d.prototype,i?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),u&&a(d.prototype,"size",{get:function(){return f(this).size}}),d},setStrong:function(e,t,i){var a=t+" Iterator",n=m(t),r=m(a);c(e,t,(function(e,t){p(this,{type:a,target:e,state:n(e),kind:t,last:void 0})}),(function(){var e=r(this),t=e.kind,i=e.last;while(i&&i.removed)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?"keys"==t?{value:i.key,done:!1}:"values"==t?{value:i.value,done:!1}:{value:[i.key,i.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),i?"entries":"values",!i,!0),d(t)}}},"6d61":function(e,t,i){"use strict";var a=i("23e7"),n=i("da84"),r=i("94ca"),o=i("6eeb"),s=i("f183"),l=i("2266"),c=i("19aa"),d=i("861d"),u=i("d039"),h=i("1c7e"),f=i("d44e"),p=i("7156");e.exports=function(e,t,i){var m=-1!==e.indexOf("Map"),y=-1!==e.indexOf("Weak"),v=m?"set":"add",g=n[e],b=g&&g.prototype,k=g,x={},S=function(e){var t=b[e];o(b,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(y&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return y&&!d(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(y&&!d(e))&&t.call(this,0===e?0:e)}:function(e,i){return t.call(this,0===e?0:e,i),this})};if(r(e,"function"!=typeof g||!(y||b.forEach&&!u((function(){(new g).entries().next()})))))k=i.getConstructor(t,e,m,v),s.REQUIRED=!0;else if(r(e,!0)){var F=new k,w=F[v](y?{}:-0,1)!=F,C=u((function(){F.has(1)})),I=h((function(e){new g(e)})),T=!y&&u((function(){var e=new g,t=5;while(t--)e[v](t,t);return!e.has(-0)}));I||(k=t((function(t,i){c(t,k,e);var a=p(new g,t,k);return void 0!=i&&l(i,a[v],a,m),a})),k.prototype=b,b.constructor=k),(C||T)&&(S("delete"),S("has"),m&&S("get")),(T||w)&&S(v),y&&b.clear&&delete b.clear}return x[e]=k,a({global:!0,forced:k!=g},x),f(k,e),y||i.setStrong(k,e,m),k}},"6f53":function(e,t,i){var a=i("83ab"),n=i("df75"),r=i("fc6a"),o=i("d1e7").f,s=function(e){return function(t){var i,s=r(t),l=n(s),c=l.length,d=0,u=[];while(c>d)i=l[d++],a&&!o.call(s,i)||u.push(e?[i,s[i]]:s[i]);return u}};e.exports={entries:s(!0),values:s(!1)}},bb2f:function(e,t,i){var a=i("d039");e.exports=!a((function(){return Object.isExtensible(Object.preventExtensions({}))}))},c20d:function(e,t,i){var a=i("da84"),n=i("58a8").trim,r=i("5899"),o=a.parseInt,s=/^[+-]?0[Xx]/,l=8!==o(r+"08")||22!==o(r+"0x16");e.exports=l?function(e,t){var i=n(String(e));return o(i,t>>>0||(s.test(i)?16:10))}:o},e01ac:function(e,t,i){"use strict";i("43f2")},f183:function(e,t,i){var a=i("d012"),n=i("861d"),r=i("5135"),o=i("9bf2").f,s=i("90e3"),l=i("bb2f"),c=s("meta"),d=0,u=Object.isExtensible||function(){return!0},h=function(e){o(e,c,{value:{objectID:"O"+ ++d,weakData:{}}})},f=function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,c)){if(!u(e))return"F";if(!t)return"E";h(e)}return e[c].objectID},p=function(e,t){if(!r(e,c)){if(!u(e))return!0;if(!t)return!1;h(e)}return e[c].weakData},m=function(e){return l&&y.REQUIRED&&u(e)&&!r(e,c)&&h(e),e},y=e.exports={REQUIRED:!1,fastKey:f,getWeakData:p,onFreeze:m};a[c]=!0}}]);